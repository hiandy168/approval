function TransExpense(){this.switchStr=!0,this.expenseReviewID="",this.expenseTotal="",this.transUserID="",this.config={breadcrumb:document.querySelector("#breadcrumb"),departmentWrap:document.querySelector("#departmentWrap"),searchApprovalInput:document.querySelector("#searchApprovalInput"),imgModal:document.querySelector("#imgModal"),confirmBtn:document.querySelector("#confirmBtn"),cancleBtn:document.querySelector("#cancleBtn")}}TransExpense.prototype={constructor:TransExpense,throttle:function(e,t){var a=null;return function(){var n=this,s=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,s)},t)}},_renderDepartSP:function(e){var t="",a=e.listUser,n=e.listDepart;if(n.length)for(var s=0,r=n.length;s<r;s++)t+='<div class="row my-row" data-departID='+n[s].departID+">",t+='<div class="col-xs-8 col-sm-8 col-md-8 my-col nowrap">',t+='<span class="departName">'+n[s].departName+"</span>",t+="</div>",t+='<div class="col-xs-4 col-sm-4 col-md-4 my-col text-right">',t+='<p><i></i>&nbsp;<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></p>',t+="</div>",t+="</div>";if(a.length)for(var s=0,r=a.length;s<r;s++)t+='<div class="row my-row" data-departUserID='+a[s].departUserID+">",t+='<div class="col-xs-8 col-sm-8 col-md-8 my-col nowrap">',t+='<span class="departUserName">'+a[s].departUserName+"</span>",t+="</div>",t+='<div class="col-xs-4 col-sm-4 col-md-4 my-col text-right">',t+="<p></p>",t+="</div>",t+="</div>";this.config.departmentWrap.innerHTML=t,this.switchStr=!0},getArg:function(){var e=window.location.href,t=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null};if(-1==e.indexOf("expenseReviewID")||!e.indexOf("expenseTotal"))throw $my.messageInfo.html("url错误").fadeIn("fast").delay("1000").fadeOut("slow"),new Error("url错误");this.expenseReviewID=t("expenseReviewID"),this.expenseTotal=t("expenseTotal")},getDepart:function(e){var t=this;$.ajax({url:getRoothPath+"/ddExpenses/userController/getDepartOrUser.do",data:{departmentID:e},success:function(e){if("{}"===JSON.stringify(e))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(e.status){case"true":var a=e.info;if("{}"===JSON.stringify(a))return void $my.messageInfo.html("返回信息为空").fadeIn("fast").delay("1000").fadeOut("slow");t._renderDepartSP(a);break;case"failure":$my.messageInfo.html("部门及人员获取错误").fadeIn("fast").delay("1000").fadeOut("slow")}}})},crumbsEvent:function(){var e=this;$(breadcrumb).on("click","li",function(t){if(t.preventDefault(),t.stopPropagation(),e.switchStr&&this.classList.contains("active")){this.classList.remove("active"),e.switchStr=!1;var a="",n=this.dataset.departmentid,s=$(this).index(),r=this.parentNode.querySelectorAll("li");r=Array.prototype.slice.apply(r),r=r.slice(0,s+1);for(var o=0,i=r.length;o<i;o++)a+=r[o].outerHTML;e.config.breadcrumb.innerHTML=a,e.getDepart(n)}})},asyncGetDepart:function(){var e=this;$(e.config.departmentWrap).on("click",".row",function(t){t.preventDefault(),t.stopPropagation();var a=document.createElement("li"),n=this.dataset.departid,s="";if(this.querySelector(".departName"))s=this.querySelector(".departName").innerHTML,a="<li data-departmentID="+n+'><a href="javascript:;">'+s+"</a></li>",e.getDepart(n),$(e.config.breadcrumb).append(a);else{var r="",o="";o=this.dataset.departuserid,r=this.querySelector(".departUserName").innerHTML,r.indexOf("-")>=0&&(r=r.substring(0,r.indexOf("-"))),e.transUserID=o,$(e.config.imgModal).modal("show")}var i=e.config.breadcrumb.querySelectorAll("li");i=Array.prototype.slice.call(i),i.pop();for(var l=0,c=i.length;l<c;l++)i[l].classList.add("active")})},searchApprovalEvent:function(){var e=this,t=!0,a=function(){var a=this.value.trim();t&&(a?$.post(getRoothPath+"/ddExpenses/userController/userLike.do",{name:a},function(t){if("{}"===JSON.stringify(t))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(t.status){case"true":var a=t.info;if("{}"===JSON.stringify(a))return void $my.messageInfo.html("返回信息为空").fadeIn("fast").delay("1000").fadeOut("slow");var n=a.data;if(!n.length)return void $my.messageInfo.html("返回信息为空").fadeIn("fast").delay("1000").fadeOut("slow");for(var s="",r=0,o=n.length;r<o;r++)s+='<div class="row my-row" data-departuserid='+n[r].id+">",s+='<div class="col-xs-12 col-sm-12 col-md-12 my-col nowrap">',s+='<span class="departUserName">'+n[r].userName+"-"+n[r].departName+"</span>",s+="</div>",s+="</div>";e.config.departmentWrap.innerHTML=s;break;case"failure":$my.messageInfo.html("查询错误").fadeIn("fast").delay("1000").fadeOut("slow")}}):e.getDepart(0))};e.config.searchApprovalInput.addEventListener("compositionstart",function(){t=!1}),e.config.searchApprovalInput.addEventListener("compositionend",function(){t=!0}),e.config.searchApprovalInput.addEventListener("input",e.throttle(a,1e3),!1)},transEvent:function(){var e=this;e.config.confirmBtn.addEventListener("click",function(t){if(t.stopPropagation(),t.preventDefault(),!e.transUserID)return void $my.messageInfo.html("移交人ID获取异常").fadeIn("fast").delay("1000").fadeOut("slow");$.ajax({url:getRoothPath+"/ddExpenses/review/transExpense.do",data:{expenseReviewID:e.expenseReviewID,userID:$my.userID,transUserID:e.transUserID,money:e.expenseTotal},success:function(e){if("{}"===JSON.stringify(e))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(e.status){case 2:$my.messageInfo.html("你已提交过该审批").fadeIn("fast").delay("1000").fadeOut("slow"),setTimeout(function(){window.location.href="index.html?control=true"},1300);break;case 1:$my.messageInfo.html("移交成功").fadeIn("fast").delay("1000").fadeOut("slow"),setTimeout(function(){window.location.href="index.html?control=true"},1300);break;case 0:$my.messageInfo.html("移交失败").fadeIn("fast").delay("1000").fadeOut("slow")}}})}),e.config.cancleBtn.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),$(e.config.imgModal).modal("hide")})},init:function(){this.getArg(),this.getDepart(0),this.asyncGetDepart(),this.searchApprovalEvent(),this.crumbsEvent(),this.transEvent()}};var transExpense=new TransExpense;$(function(){window.$my={messageInfo:$(".messageInfo"),userID:sessionStorage.getItem("ddUserID")},transExpense.init()});