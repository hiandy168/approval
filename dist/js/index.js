function Approval(){this.mySponsoredCount="",this.myExpenseCount="",this.ddUserID="",Object.defineProperty(this,"mySponsoredCount",{get:function(){return/^[0-9]*$/.test(mySponsoredCount)&&""!=mySponsoredCount?mySponsoredCount:mySponsoredCount="--"},set:function(e){e>99?mySponsoredCount="99+":e>=0&&e<=99&&(mySponsoredCount=e)}}),Object.defineProperty(this,"myExpenseCount",{get:function(){return/^[0-9]*$/.test(myExpenseCount)&&""!=myExpenseCount?myExpenseCount:myExpenseCount="--"},set:function(e){e>99?myExpenseCount="99+":e>=0&&e<=99&&(myExpenseCount=e)}}),this.config={mySponsoredCount:document.querySelector("#mySponsoredCount"),myExpenseCount:document.querySelector("#myExpenseCount"),content:document.getElementById("content"),footer:document.querySelector(".footer")}}Approval.prototype={throttle:function(e,t){clearTimeout(e.tId),e.tId=setTimeout(function(){e.call(t)},200)},getParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},get_ddUserID:function(){var e=sessionStorage.getItem("loginid");if(e)this.ddUserID=e;else{if(-1==window.location.href.indexOf("ddUserID"))throw $my.messageInfo.html("url错误").fadeIn("fast").delay("1000").fadeOut("slow"),new Error("url错误");var t=window.location.search;t=t.split("=")[1],this.ddUserID=t,sessionStorage.setItem("loginid",t)}},verification:function(){var e=this;if(""==e.ddUserID||null==e.ddUserID||"null"==e.ddUserID)return void $my.messageInfo.html("用户ID丢失").fadeIn("fast").delay("1000").fadeOut("slow");$.ajax({url:getRoothPath+"/ddExpenses/userController/login.do",data:{ddUserID:e.ddUserID},success:function(t){if("{}"===JSON.stringify(t))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(t.status){case"true":var n,o;if(n=t.info,!n.length)return void $my.messageInfo.html("返回信息为空").fadeIn("fast").delay("1000").fadeOut("slow");o=n[0].userID,sessionStorage.setItem("ddUserID",o),e._getUnreadNum(o);break;case"failure":dd.device.notification.vibrate({duration:300,onSuccess:function(e){},onFail:function(e){}}),dd.device.notification.alert({message:"登录错误",title:"提示",buttonName:"确定",close:!1,onSuccess:function(){dd.biz.navigation.close()},onFail:function(e){dd.biz.navigation.close()}})}}})},bindDom:function(){this.config.mySponsoredCount.innerHTML=this.mySponsoredCount,this.config.myExpenseCount.innerHTML=this.myExpenseCount},_getUnreadNum:function(e){var t=this;if(""==e||null==e||"null"==e)return void $my.messageInfo.html("用户ID丢失").fadeIn("fast").delay("1000").fadeOut("slow");$.ajax({url:getRoothPath+"/ddExpenses/expenseInfo/sum.do",data:{userID:e},success:function(e){if("{}"===JSON.stringify(e))return $my.messageInfo.html("暂无数据").fadeIn("fast").delay("1000").fadeOut("slow"),!1;switch(e.status){case"true":var n=e.info,o=n.myExpenseCount,s=n.mySponsoredCount;t.myExpenseCount=o,t.mySponsoredCount=s,t.bindDom();break;case"failure":$my.messageInfo.html("查询错误").fadeIn("fast").delay("1000").fadeOut("slow")}}})},buffer:function(){switch($(this).index()){case 0:window.location.href="myApproval.html";break;case 1:window.location.href="mySponser.html"}},bindEvents:function(){var e=this,t=e.config.content.querySelectorAll("li"),n=function(){window.location.href="sponsor.html"};Array.prototype.forEach.call(t,function(t,n){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.throttle(e.buffer,this)},!1)}),this.config.footer.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.throttle(n,this)},!1)},init:function(){this.get_ddUserID(),this.verification(),this.bindEvents()}};var approval=new Approval;$(function(){window.$my={messageInfo:$(".messageInfo")},approval.init(),function(){localStorage.removeItem("sessionTouchData_mySponser"),localStorage.removeItem("pageNum_mySponser"),localStorage.removeItem("dataCount_mySponser"),localStorage.removeItem("isEnd_mySponser"),localStorage.removeItem("sessionTouchData_myApproval"),localStorage.removeItem("pageNum_myApproval"),localStorage.removeItem("dataCount_myApproval"),localStorage.removeItem("isEnd_myApproval")}()}),dd.ready(function(){approval.init(),dd.ui.webViewBounce.disable(),dd.ui.pullToRefresh.disable(),approval.getParam("control")?(document.addEventListener("backbutton",function(e){e.preventDefault(),dd.device.notification.alert({message:"当前不可回退操作",title:"提示",buttonName:"确定",onSuccess:function(){},onFail:function(e){}})}),dd.biz.navigation.setLeft({control:!0,text:"",onSuccess:function(e){dd.device.notification.alert({message:"当前不可回退操作",title:"提示",buttonName:"收到",onSuccess:function(){},onFail:function(e){}})},onFail:function(e){}})):dd.biz.navigation.setLeft({control:!1,text:"",onSuccess:function(e){},onFail:function(e){}})});